<?xml version="1.0" encoding="UTF-8" ?>
<schema name="b2b-products" version="1.6">
    
    <!-- Unique Key -->
    <uniqueKey>id</uniqueKey>
    
    <!-- Field Types -->
    <fieldType name="string" class="solr.StrField" sortMissingLast="true" docValues="true"/>
    <fieldType name="strings" class="solr.StrField" sortMissingLast="true" multiValued="true" docValues="true"/>
    <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true"/>
    <fieldType name="booleans" class="solr.BoolField" sortMissingLast="true" multiValued="true"/>
    <fieldType name="pint" class="solr.IntPointField" docValues="true"/>
    <fieldType name="pints" class="solr.IntPointField" docValues="true" multiValued="true"/>
    <fieldType name="plong" class="solr.LongPointField" docValues="true"/>
    <fieldType name="plongs" class="solr.LongPointField" docValues="true" multiValued="true"/>
    <fieldType name="pdouble" class="solr.DoublePointField" docValues="true"/>
    <fieldType name="pdoubles" class="solr.DoublePointField" docValues="true" multiValued="true"/>
    <fieldType name="pfloat" class="solr.FloatPointField" docValues="true"/>
    <fieldType name="pfloats" class="solr.FloatPointField" docValues="true" multiValued="true"/>
    <fieldType name="pdate" class="solr.DatePointField" docValues="true"/>
    <fieldType name="pdates" class="solr.DatePointField" docValues="true" multiValued="true"/>
    
    <!-- Text Field Types -->
    <fieldType name="text_general" class="solr.TextField" positionIncrementGap="100" multiValued="true">
        <analyzer type="index">
            <tokenizer class="solr.StandardTokenizerFactory"/>
            <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.PorterStemFilterFactory"/>
        </analyzer>
        <analyzer type="query">
            <tokenizer class="solr.StandardTokenizerFactory"/>
            <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
            <filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.PorterStemFilterFactory"/>
        </analyzer>
    </fieldType>
    
    <!-- Text field with edge ngram for autocomplete -->
    <fieldType name="text_autocomplete" class="solr.TextField" positionIncrementGap="100">
        <analyzer type="index">
            <tokenizer class="solr.WhitespaceTokenizerFactory"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.EdgeNGramFilterFactory" minGramSize="2" maxGramSize="15"/>
        </analyzer>
        <analyzer type="query">
            <tokenizer class="solr.WhitespaceTokenizerFactory"/>
            <filter class="solr.LowerCaseFilterFactory"/>
        </analyzer>
    </fieldType>
    
    <!-- Text field for phonetic matching -->
    <fieldType name="text_phonetic" class="solr.TextField" positionIncrementGap="100">
        <analyzer>
            <tokenizer class="solr.StandardTokenizerFactory"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.DoubleMetaphoneFilterFactory" inject="false"/>
        </analyzer>
    </fieldType>
    
    <!-- Text field with synonyms -->
    <fieldType name="text_en" class="solr.TextField" positionIncrementGap="100">
        <analyzer type="index">
            <tokenizer class="solr.StandardTokenizerFactory"/>
            <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.EnglishPossessiveFilterFactory"/>
            <filter class="solr.KeywordMarkerFilterFactory" protected="protwords.txt"/>
            <filter class="solr.PorterStemFilterFactory"/>
        </analyzer>
        <analyzer type="query">
            <tokenizer class="solr.StandardTokenizerFactory"/>
            <filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
            <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
            <filter class="solr.LowerCaseFilterFactory"/>
            <filter class="solr.EnglishPossessiveFilterFactory"/>
            <filter class="solr.KeywordMarkerFilterFactory" protected="protwords.txt"/>
            <filter class="solr.PorterStemFilterFactory"/>
        </analyzer>
    </fieldType>
    
    <!-- ============== Fields ============== -->
    
    <!-- Core Fields -->
    <field name="id" type="string" indexed="true" stored="true" required="true" multiValued="false"/>
    <field name="productId" type="plong" indexed="true" stored="true"/>
    <field name="_version_" type="plong" indexed="false" stored="false"/>
    
    <!-- Product Information -->
    <field name="name" type="text_en" indexed="true" stored="true"/>
    <field name="name_autocomplete" type="text_autocomplete" indexed="true" stored="false"/>
    <field name="name_exact" type="string" indexed="true" stored="false"/>
    <field name="description" type="text_en" indexed="true" stored="true"/>
    <field name="sku" type="string" indexed="true" stored="true"/>
    
    <!-- Pricing -->
    <field name="price" type="pdouble" indexed="true" stored="true"/>
    <field name="moq" type="pint" indexed="true" stored="true"/>
    <field name="stockQuantity" type="pint" indexed="true" stored="true"/>
    
    <!-- Category & Supplier -->
    <field name="categoryId" type="plong" indexed="true" stored="true"/>
    <field name="categoryName" type="text_general" indexed="true" stored="true"/>
    <field name="categoryName_facet" type="string" indexed="true" stored="false"/>
    <field name="supplierId" type="plong" indexed="true" stored="true"/>
    <field name="supplierName" type="text_general" indexed="true" stored="true"/>
    <field name="supplierName_facet" type="string" indexed="true" stored="false"/>
    
    <!-- Origin -->
    <field name="origin" type="string" indexed="true" stored="true"/>
    
    <!-- Ratings & Reviews -->
    <field name="rating" type="pdouble" indexed="true" stored="true"/>
    <field name="reviewCount" type="pint" indexed="true" stored="true"/>
    
    <!-- Tags -->
    <field name="tags" type="strings" indexed="true" stored="true" multiValued="true"/>
    
    <!-- Flags -->
    <field name="isFeatured" type="boolean" indexed="true" stored="true"/>
    <field name="isActive" type="boolean" indexed="true" stored="true"/>
    
    <!-- Images -->
    <field name="imageUrl" type="string" indexed="false" stored="true" docValues="false"/>
    
    <!-- Timestamps -->
    <field name="createdAt" type="pdate" indexed="true" stored="true"/>
    <field name="updatedAt" type="pdate" indexed="true" stored="true"/>
    
    <!-- ============== Bundle Fields ============== -->
    <field name="docType" type="string" indexed="true" stored="true" default="product"/>
    <field name="bundleId" type="plong" indexed="true" stored="true"/>
    <field name="discountPercentage" type="pdouble" indexed="true" stored="true"/>
    <field name="originalPrice" type="pdouble" indexed="true" stored="true"/>
    <field name="bundlePrice" type="pdouble" indexed="true" stored="true"/>
    <field name="totalItems" type="pint" indexed="true" stored="true"/>
    <field name="productIds" type="plongs" indexed="true" stored="true" multiValued="true"/>
    <field name="productNames" type="text_general" indexed="true" stored="true" multiValued="true"/>
    
    <!-- Catch-all field for full-text search -->
    <field name="text" type="text_general" indexed="true" stored="false" multiValued="true"/>
    
    <!-- Copy fields for search enhancement -->
    <copyField source="name" dest="name_autocomplete"/>
    <copyField source="name" dest="name_exact"/>
    <copyField source="categoryName" dest="categoryName_facet"/>
    <copyField source="supplierName" dest="supplierName_facet"/>
    <copyField source="name" dest="text"/>
    <copyField source="description" dest="text"/>
    <copyField source="categoryName" dest="text"/>
    <copyField source="supplierName" dest="text"/>
    <copyField source="tags" dest="text"/>
    <copyField source="sku" dest="text"/>
    <copyField source="productNames" dest="text"/>
    
</schema>
